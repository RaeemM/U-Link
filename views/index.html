<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>U-LINK Feed</title>
  <link rel="stylesheet" href="/style.css" />
</head>
<body>
  <div class="container">
    <h1>üïäÔ∏è U-LINK Feed</h1>

    <h2>Latest Posts from UWIGlobalCampus</h2>
    <button id="refreshBtn" onclick="loadTimeline()">Refresh Timeline</button>
    <ul id="tweetList"></ul>
  </div>

  <script>
    async function loadTimeline() {
      const tweetList = document.getElementById('tweetList');
      const btn = document.getElementById('refreshBtn');

      // Disable button temporarily
      btn.disabled = true;
      btn.textContent = "Cooldown...";

      // Show loading state
      tweetList.innerHTML = '<li>Loading tweets...</li>';

      try {
        const response = await fetch('/twitter/timeline');
        const data = await response.json();

        tweetList.innerHTML = ''; // Clear loading

        if (data.message?.includes("Rate limit")) {
          tweetList.innerHTML = '<li style="color: orange;">‚õî Rate limit hit. Please wait 15 minutes.</li>';
          return;
        }

        if (!data.data || data.data.length === 0) {
          tweetList.innerHTML = '<li>No tweets found.</li>';
          return;
        }

        data.data.forEach(tweet => {
          const li = document.createElement('li');
          li.textContent = tweet.text;
          tweetList.appendChild(li);
        });
      } catch (err) {
        tweetList.innerHTML = '<li style="color: red;">‚ö†Ô∏è An error occurred while fetching tweets.</li>';
        console.error('Frontend fetch error:', err);
      } finally {
        setTimeout(() => {
          btn.disabled = false;
          btn.textContent = "Refresh Timeline";
        }, 15000); // Cooldown for 15 seconds
      }
    }

    // Auto load on page open
    loadTimeline();
  </script>
</body>
</html>
